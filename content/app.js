importScripts("https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js");

function sendPatch(patch, buffers, msg_id) {
  self.postMessage({
    type: 'patch',
    patch: patch,
    buffers: buffers
  })
}

async function startApplication() {
  console.log("Loading pyodide!");
  self.postMessage({type: 'status', msg: 'Loading pyodide'})
  self.pyodide = await loadPyodide();
  self.pyodide.globals.set("sendPatch", sendPatch);
  console.log("Loaded!");
  await self.pyodide.loadPackage("micropip");
  const env_spec = ['https://cdn.holoviz.org/panel/wheels/bokeh-3.4.0-py3-none-any.whl', 'https://cdn.holoviz.org/panel/1.4.2/dist/wheels/panel-1.4.2-py3-none-any.whl', 'pyodide-http==0.2.1', 'hvplot', 'pandas', 'param', 'pyecharts']
  for (const pkg of env_spec) {
    let pkg_name;
    if (pkg.endsWith('.whl')) {
      pkg_name = pkg.split('/').slice(-1)[0].split('-')[0]
    } else {
      pkg_name = pkg
    }
    self.postMessage({type: 'status', msg: `Installing ${pkg_name}`})
    try {
      await self.pyodide.runPythonAsync(`
        import micropip
        await micropip.install('${pkg}');
      `);
    } catch(e) {
      console.log(e)
      self.postMessage({
	type: 'status',
	msg: `Error while installing ${pkg_name}`
      });
    }
  }
  console.log("Packages loaded!");
  self.postMessage({type: 'status', msg: 'Executing code'})
  const code = `
  \nimport asyncio\n\nfrom panel.io.pyodide import init_doc, write_doc\n\ninit_doc()\n\n#!/usr/bin/env python\n# coding: utf-8\n\n# # Interface panel design\n# # Develop in [a notebook](https://panel.holoviz.org/tutorials/basic/develop_notebook.html)\n# * [Core concepts](https://panel.holoviz.org/getting_started/core_concepts.html)\n# * [Example: Declarative](https://panel.holoviz.org/explanation/api/examples/stocks_declarative.html)\n\n# In[1]:\n\n\n# Datapipeline\nimport pandas as pd\n\n\n\n# In[2]:\n\n\n# App and visualiation\nimport panel as pn\npn.extension('tabulator')\n\n\n# In[3]:\n\n\nlocale = 'zh_hans'\n\n\n# ## Data\n# ### ETL\n# #### Dataframes from parquet\n\n\n\n# In[5]:\n\n# In[6]:\n\n\n# #### Dictionaries from yml\n\n# In[7]:\n\n\n#locale="zh_hans"\n\n\n# In[8]:\n\n\n\n# In[4]:\n#dfN_locale = pd.read_pickle ('dfN_zh_hans.pickle')\n#dfE_locale = pd.read_pickle ('dfE_zh_hans.pickle')\ndfE_locale = pd.read_pickle ('https://oxon8.github.io/jupyterlite/files/html/dfE_zh_hans.pickle')\ndfN_locale = pd.read_pickle ('https://oxon8.github.io/jupyterlite/files/html/dfN_zh_hans.pickle')\n\n# ### Minimal Efforts for Echarts/Tabulator\n\n# #### List of "selected" stuff\n# * legacy: CEADs_loaded.lists.keys() ['indicators_sel', 'reg_all', 'year_all', 'Mkind_all', 'locale_all', 'sel_indicators_MI', 'sel_indicators_MO']\n\n# In[9]:\n\n\nsel_cols_locale = ['code', 'zh_hant', 'en', 'zh_hans']\n\n\n# #### C1. Reg and Year\n\n# In[10]:\n\n\n## Reg and Year\nyear_all = {'code': ['2012', '2015', '2017', '2017new'], 'zh_hant': ['2012', '2015', '2017', '2017\u65b0'], 'en': ['2012', '2015', '2017', '2017 new'], 'zh_hans': ['2012', '2015', '2017', '2017\u65b0']}\n\nreg_all = {'code': ['BJ', 'TJ', 'HE', 'SX', 'NM', 'LN', 'JL', 'HL', 'SH', 'JS', 'ZJ', 'AH', 'FJ', 'JX', 'SD', 'HA', 'HB', 'HN', 'GD', 'GX', 'HI', 'CQ', 'SC', 'GZ', 'YN', 'XZ', 'SN', 'GS', 'QH', 'NX', 'XJ'], 'zh_hant': ['\u5317\u4eac', '\u5929\u6d25', '\u6cb3\u5317', '\u5c71\u897f', '\u5167\u8499\u53e4', '\u907c\u5be7', '\u5409\u6797', '\u9ed1\u9f8d\u6c5f', '\u4e0a\u6d77', '\u6c5f\u8607', '\u6d59\u6c5f', '\u5b89\u5fbd', '\u798f\u5efa', '\u6c5f\u897f', '\u5c71\u6771', '\u6cb3\u5357', '\u6e56\u5317', '\u6e56\u5357', '\u5ee3\u6771', '\u5ee3\u897f', '\u6d77\u5357', '\u91cd\u6176', '\u56db\u5ddd', '\u8cb4\u5dde', '\u96f2\u5357', '\u897f\u85cf', '\u965d\u897f', '\u7518\u8085', '\u9752\u6d77', '\u5be7\u590f', '\u65b0\u7586'], 'en': ['Beijing', 'Tianjin', 'Hebei', 'Shanxi', 'Inner Mongolia', 'Liaoning', 'Jilin', 'Heilongjiang', 'Shanghai', 'Jiangsu', 'Zhejiang', 'Anhui', 'Fujian', 'Jiangxi', 'Shandong', 'Henan', 'Hubei', 'Hunan', 'Guangdong', 'Guangxi', 'Hainan', 'Chongqing', 'Sichuan', 'Guizhou', 'Yunnan', 'Tibet', 'Shaanxi', 'Gansu', 'Qinghai', 'Ningxia', 'Xinjiang'], 'zh_hans': ['\u5317\u4eac', '\u5929\u6d25', '\u6cb3\u5317', '\u5c71\u897f', '\u5185\u8499\u53e4', '\u8fbd\u5b81', '\u5409\u6797', '\u9ed1\u9f99\u6c5f', '\u4e0a\u6d77', '\u6c5f\u82cf', '\u6d59\u6c5f', '\u5b89\u5fbd', '\u798f\u5efa', '\u6c5f\u897f', '\u5c71\u4e1c', '\u6cb3\u5357', '\u6e56\u5317', '\u6e56\u5357', '\u5e7f\u4e1c', '\u5e7f\u897f', '\u6d77\u5357', '\u91cd\u5e86', '\u56db\u5ddd', '\u8d35\u5dde', '\u4e91\u5357', '\u897f\u85cf', '\u9655\u897f', '\u7518\u8083', '\u9752\u6d77', '\u5b81\u590f', '\u65b0\u7586']}\n# In[11]:\n\n\n\n# In[12]:\n\n\nreg_dict_UI = dict(zip(reg_all ['code'], reg_all ['zh_hans']))\nreg_dict_UI_joint = [":".join([k,v]) for k,v in reg_dict_UI.items()]\n\n\n# #### C2. Indicators\n\n# In[13]:\n\n\n# Loading both existig data, along with translation:\n#https://stackoverflow.com/questions/952914/how-do-i-make-a-flat-list-out-of-a-list-of-lists\nimport itertools\n\n# all_indicators, sel_indicators\nall_indicators = {'code': {'CI': ['_CI_', '_CIVA_', '_CIFU_'], 'MI': ['TI', '_R69_', '_CO2_', 'IM', 'TII', 'VA001', 'VA004', 'TVA'], 'MIMO': ['NodeIntra', 'OutputSum', 'InputSum'], 'MO': ['GO', 'EX', 'TFU', 'FU101', 'FU102', 'FU103', 'FU201', 'FU202'], 'metrics': ['eigenvector', 'betweenness', 'closeness_centrality', 'katz', 'pagerank', 'in_degree_centrality', 'out_degree_centrality', 'clustcoef']}, 'zh_hant': {'CI': ['\u78b3\u6392\u5f37\u5ea6', '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTVA', '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTFU'], 'MI': ['\u7e3d\u6295\u5165', '\u7e3d\u7522\u51fa', 'CO2\u6392\u653e', '\u9032\u53e3', '\u7e3d\u4e2d\u9593\u6295\u5165', '\u52de\u52d5\u8005\u5831\u916c', '\u71df\u696d\u76c8\u4f59', '\u589e\u52a0\u503c'], 'MIMO': ['\u7522\u696d\u5167', '\u7522\u51fa\u5408', '\u6295\u5165\u548c'], 'MO': ['\u7e3d\u7522\u51fa2', '\u51fa\u53e3', '\u6700\u7d42\u4f7f\u7528', '\u6d88\u8cbb(\u8fb2\u6751)', '\u6d88\u8cbb(\u57ce\u93ae)', '\u6d88\u8cbb(\u653f\u5e9c)', '\u56fa\u5b9a\u8cc7\u672c\u5f62\u6210', '\u5b58\u8ca8\u589e\u52a0'], 'metrics': ['\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', '\u4ecb\u4e2d\u5fc3\u6027', '\u89aa\u8fd1\u4e2d\u5fc3\u6027', 'Katz\u4e2d\u5fc3\u6027', 'Pagerank\u4e2d\u5fc3\u6027', '\u5165\u5ea6\u4e2d\u5fc3\u6027', '\u51fa\u5ea6\u4e2d\u5fc3\u6027', '\u805a\u985e\u7cfb\u6578']}, 'en': {'CI': ['Carbon intensity', 'Carbon intensity (per TVA) ', 'Carbon intensity (per TFU) '], 'MI': ['Input Total', 'Total', 'CO2', 'Imports', 'Intermediate input total', 'Labor compensation', 'Operation profit', 'Value added at basic prices'], 'MIMO': ['Intra-Industry', 'OutputSum', 'Input Sum'], 'MO': ['Total2', 'Exports', 'Final consumption', 'Consumption (Rural)', 'Consumption (Urban)', 'Consumption (Gov.)', 'Fixed capital formation', 'Invetory change'], 'metrics': ['Eigenvector', 'Betweenness', 'Closeness Centrality', 'Katz', 'PageRank', 'In-degree Centrality', 'Out-degree Centrality', 'Clustering coefficient']}, 'zh_hans': {'CI': ['\u78b3\u6392\u5f3a\u5ea6', '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTVA', '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTFU'], 'MI': ['\u603b\u6295\u5165', '\u603b\u4ea7\u51fa', 'CO2\u6392\u653e', '\u8fdb\u53e3', '\u603b\u4e2d\u95f4\u6295\u5165', '\u52b3\u52a8\u8005\u62a5\u916c', '\u8425\u4e1a\u76c8\u4f59', '\u589e\u52a0\u503c'], 'MIMO': ['\u4ea7\u4e1a\u5185', '\u4ea7\u51fa\u5408', '\u6295\u5165\u548c'], 'MO': ['\u603b\u4ea7\u51fa2', '\u51fa\u53e3', '\u6700\u7ec8\u4f7f\u7528', '\u6d88\u8d39(\u519c\u6751)', '\u6d88\u8d39(\u57ce\u9547)', '\u6d88\u8d39(\u653f\u5e9c)', '\u56fa\u5b9a\u8d44\u672c\u5f62\u6210', '\u5b58\u8d27\u589e\u52a0'], 'metrics': ['\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', '\u4ecb\u4e2d\u5fc3\u6027', '\u4eb2\u8fd1\u4e2d\u5fc3\u6027', 'Katz\u4e2d\u5fc3\u6027', 'PageRank', '\u5165\u5ea6\u4e2d\u5fc3\u6027', '\u51fa\u5ea6\u4e2d\u5fc3\u6027', '\u805a\u7c7b\u7cfb\u6570']}}\nsel_indicators = {'code': {'CI': ['_CI_'], 'MI': ['TI', '_R69_', '_CO2_', 'IM', 'TII', 'TVA'], 'MIMO': ['InputSum', 'OutputSum', 'NodeIntra'], 'MO': ['GO', 'EX', 'TFU'], 'metrics': ['eigenvector', 'in_degree_centrality', 'out_degree_centrality']}, 'zh_hant': {'CI': ['\u78b3\u6392\u5f37\u5ea6'], 'MI': ['\u7e3d\u6295\u5165', '\u7e3d\u7522\u51fa', 'CO2\u6392\u653e', '\u9032\u53e3', '\u7e3d\u4e2d\u9593\u6295\u5165', '\u589e\u52a0\u503c'], 'MIMO': ['\u6295\u5165\u548c', '\u7522\u51fa\u5408', '\u7522\u696d\u5167'], 'MO': ['\u7e3d\u7522\u51fa2', '\u51fa\u53e3', '\u6700\u7d42\u4f7f\u7528'], 'metrics': ['\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', '\u5165\u5ea6\u4e2d\u5fc3\u6027', '\u51fa\u5ea6\u4e2d\u5fc3\u6027']}, 'en': {'CI': ['Carbon intensity'], 'MI': ['Input Total', 'Total', 'CO2', 'Imports', 'Intermediate input total', 'Value added at basic prices'], 'MIMO': ['Input Sum', 'OutputSum', 'Intra-Industry'], 'MO': ['Total2', 'Exports', 'Final consumption'], 'metrics': ['Eigenvector', 'In-degree Centrality', 'Out-degree Centrality']}, 'zh_hans': {'CI': ['\u78b3\u6392\u5f3a\u5ea6'], 'MI': ['\u603b\u6295\u5165', '\u603b\u4ea7\u51fa', 'CO2\u6392\u653e', '\u8fdb\u53e3', '\u603b\u4e2d\u95f4\u6295\u5165', '\u589e\u52a0\u503c'], 'MIMO': ['\u6295\u5165\u548c', '\u4ea7\u51fa\u5408', '\u4ea7\u4e1a\u5185'], 'MO': ['\u603b\u4ea7\u51fa2', '\u51fa\u53e3', '\u6700\u7ec8\u4f7f\u7528'], 'metrics': ['\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', '\u5165\u5ea6\u4e2d\u5fc3\u6027', '\u51fa\u5ea6\u4e2d\u5fc3\u6027']}}\n\nall_indicators_list = {'code': ['_CI_', '_CIVA_', '_CIFU_', 'TI', '_R69_', '_CO2_', 'IM', 'TII', 'VA001', 'VA004', 'TVA', 'NodeIntra', 'OutputSum', 'InputSum', 'GO', 'EX', 'TFU', 'FU101', 'FU102', 'FU103', 'FU201', 'FU202', 'eigenvector', 'betweenness', 'closeness_centrality', 'katz', 'pagerank', 'in_degree_centrality', 'out_degree_centrality', 'clustcoef'], 'zh_hant': ['\u78b3\u6392\u5f37\u5ea6', '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTVA', '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTFU', '\u7e3d\u6295\u5165', '\u7e3d\u7522\u51fa', 'CO2\u6392\u653e', '\u9032\u53e3', '\u7e3d\u4e2d\u9593\u6295\u5165', '\u52de\u52d5\u8005\u5831\u916c', '\u71df\u696d\u76c8\u4f59', '\u589e\u52a0\u503c', '\u7522\u696d\u5167', '\u7522\u51fa\u5408', '\u6295\u5165\u548c', '\u7e3d\u7522\u51fa2', '\u51fa\u53e3', '\u6700\u7d42\u4f7f\u7528', '\u6d88\u8cbb(\u8fb2\u6751)', '\u6d88\u8cbb(\u57ce\u93ae)', '\u6d88\u8cbb(\u653f\u5e9c)', '\u56fa\u5b9a\u8cc7\u672c\u5f62\u6210', '\u5b58\u8ca8\u589e\u52a0', '\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', '\u4ecb\u4e2d\u5fc3\u6027', '\u89aa\u8fd1\u4e2d\u5fc3\u6027', 'Katz\u4e2d\u5fc3\u6027', 'Pagerank\u4e2d\u5fc3\u6027', '\u5165\u5ea6\u4e2d\u5fc3\u6027', '\u51fa\u5ea6\u4e2d\u5fc3\u6027', '\u805a\u985e\u7cfb\u6578'], 'en': ['Carbon intensity', 'Carbon intensity (per TVA) ', 'Carbon intensity (per TFU) ', 'Input Total', 'Total', 'CO2', 'Imports', 'Intermediate input total', 'Labor compensation', 'Operation profit', 'Value added at basic prices', 'Intra-Industry', 'OutputSum', 'Input Sum', 'Total2', 'Exports', 'Final consumption', 'Consumption (Rural)', 'Consumption (Urban)', 'Consumption (Gov.)', 'Fixed capital formation', 'Invetory change', 'Eigenvector', 'Betweenness', 'Closeness Centrality', 'Katz', 'PageRank', 'In-degree Centrality', 'Out-degree Centrality', 'Clustering coefficient'], 'zh_hans': ['\u78b3\u6392\u5f3a\u5ea6', '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTVA', '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTFU', '\u603b\u6295\u5165', '\u603b\u4ea7\u51fa', 'CO2\u6392\u653e', '\u8fdb\u53e3', '\u603b\u4e2d\u95f4\u6295\u5165', '\u52b3\u52a8\u8005\u62a5\u916c', '\u8425\u4e1a\u76c8\u4f59', '\u589e\u52a0\u503c', '\u4ea7\u4e1a\u5185', '\u4ea7\u51fa\u5408', '\u6295\u5165\u548c', '\u603b\u4ea7\u51fa2', '\u51fa\u53e3', '\u6700\u7ec8\u4f7f\u7528', '\u6d88\u8d39(\u519c\u6751)', '\u6d88\u8d39(\u57ce\u9547)', '\u6d88\u8d39(\u653f\u5e9c)', '\u56fa\u5b9a\u8d44\u672c\u5f62\u6210', '\u5b58\u8d27\u589e\u52a0', '\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', '\u4ecb\u4e2d\u5fc3\u6027', '\u4eb2\u8fd1\u4e2d\u5fc3\u6027', 'Katz\u4e2d\u5fc3\u6027', 'PageRank', '\u5165\u5ea6\u4e2d\u5fc3\u6027', '\u51fa\u5ea6\u4e2d\u5fc3\u6027', '\u805a\u7c7b\u7cfb\u6570']}\n\n\nsel_indicators_list = {'code': ['_CI_', 'TI', '_R69_', '_CO2_', 'IM', 'TII', 'TVA', 'InputSum', 'OutputSum', 'NodeIntra', 'GO', 'EX', 'TFU', 'eigenvector', 'in_degree_centrality', 'out_degree_centrality'], 'zh_hant': ['\u78b3\u6392\u5f37\u5ea6', '\u7e3d\u6295\u5165', '\u7e3d\u7522\u51fa', 'CO2\u6392\u653e', '\u9032\u53e3', '\u7e3d\u4e2d\u9593\u6295\u5165', '\u589e\u52a0\u503c', '\u6295\u5165\u548c', '\u7522\u51fa\u5408', '\u7522\u696d\u5167', '\u7e3d\u7522\u51fa2', '\u51fa\u53e3', '\u6700\u7d42\u4f7f\u7528', '\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', '\u5165\u5ea6\u4e2d\u5fc3\u6027', '\u51fa\u5ea6\u4e2d\u5fc3\u6027'], 'en': ['Carbon intensity', 'Input Total', 'Total', 'CO2', 'Imports', 'Intermediate input total', 'Value added at basic prices', 'Input Sum', 'OutputSum', 'Intra-Industry', 'Total2', 'Exports', 'Final consumption', 'Eigenvector', 'In-degree Centrality', 'Out-degree Centrality'], 'zh_hans': ['\u78b3\u6392\u5f3a\u5ea6', '\u603b\u6295\u5165', '\u603b\u4ea7\u51fa', 'CO2\u6392\u653e', '\u8fdb\u53e3', '\u603b\u4e2d\u95f4\u6295\u5165', '\u589e\u52a0\u503c', '\u6295\u5165\u548c', '\u4ea7\u51fa\u5408', '\u4ea7\u4e1a\u5185', '\u603b\u4ea7\u51fa2', '\u51fa\u53e3', '\u6700\u7ec8\u4f7f\u7528', '\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', '\u5165\u5ea6\u4e2d\u5fc3\u6027', '\u51fa\u5ea6\u4e2d\u5fc3\u6027']}\n\n\n\n# #### C3. Color and Translation \n\n# In[14]:\n\n\n# Loading both color and dict_trans\nd_color = {'code': {'c1': '#12711c', 'c10_11': '#592f0d', 'c12': '#3c3c3c', 'c13g': '#8c0800', 'c13i': '#8c0800', 'c13m': '#592f0d', 'c13s': '#8c0800', 'c14a': '#8c0800', 'c14b': '#8c0800', 'c15': '#8c0800', 'c16': '#006374', 'c16m': '#592f0d', 'c16w': '#006374', 'c17e': '#b8850a', 'c17g': '#b8850a', 'c17w': '#006374', 'c18': '#b1400d', 'c19': '#006374', 'c20_21': '#b1400d', 'c22': '#b1400d', 'c23_26': '#b1400d', 'c27': '#001c7f', 'c28': '#a23582', 'c29': '#a23582', 'c2c': '#b8850a', 'c2m': '#12711c', 'c2n': '#12711c', 'c2p': '#b8850a', 'c3': '#3c3c3c', 'c30': '#a23582', 'c31': '#591e71', 'c32': '#591e71', 'c33': '#591e71', 'c34': '#006374', 'c35': '#591e71', 'c4': '#3c3c3c', 'c5': '#592f0d', 'c6': '#3c3c3c', 'c7': '#592f0d', 'c8': '#3c3c3c', 'c9': '#592f0d', 'mcult': '#591e71', 'msci': '#001c7f', 'mscitech': '#001c7f', 'mtech': '#001c7f'}, 'zh_hant': {'\u4ea4\u901a\u904b\u8f38\u8a2d\u5099': '#8c0800', '\u4ea7\u4f9b\u6c34': '#006374', '\u4ea7\u4f9b\u71c3\u6c14': '#b8850a', '\u4ea7\u4f9b\u7535\u70ed\u529b': '#b8850a', '\u4f4f\u5bbf\u9910\u98f2': '#b1400d', '\u4fe1\u901a\u8f6f\u4ef6\u6280\u672f': '#001c7f', '\u4fee\u7406\u91d1\u673a\u8bbe\u5907': '#006374', '\u5100\u5668\u5100\u8868': '#8c0800', '\u516c\u5171\u7ba1\u7406': '#591e71', '\u5236\u5316\u5b66': '#592f0d', '\u5236\u670d\u978b\u5e3d\u76ae\u7fbd': '#592f0d', '\u5236\u7eb8\u5370\u5237\u6587\u6559': '#592f0d', '\u5236\u9020\u5176\u4ed6': '#592f0d', '\u5236\u9020\u5176\u4ed6\u56de\u6536': '#006374', '\u5236\u91d1\u5c5e\u5236\u54c1': '#592f0d', '\u5236\u975e\u91d1\u5c5e': '#592f0d', '\u52a0\u5de5\u6728\u6750\u5bb6\u5177': '#3c3c3c', '\u52a0\u5de5\u77f3\u6cb9\u7126\u6838': '#3c3c3c', '\u52a0\u5de5\u91d1\u5c5e\u51b6\u70bc': '#3c3c3c', '\u52a0\u5de5\u98df\u54c1\u70df\u8349': '#3c3c3c', '\u56de\u6536': '#006374', '\u5c08\u7528\u8a2d\u5099': '#8c0800', '\u5c45\u6c11\u670d\u52a1\u4fee\u7406': '#591e71', '\u5efa\u7bc9': '#b1400d', '\u623f\u5730\u7522': '#a23582', '\u6279\u767c\u96f6\u552e': '#b1400d', '\u6280\u8853\u670d\u52d9': '#001c7f', '\u6559\u80b2': '#591e71', '\u6587\u5316\u4f53\u80b2\u5a31\u4e50': '#591e71', '\u6c34\u5229\u73af\u5883\u516c\u8bbe': '#006374', '\u77ff\u91c7\u91d1\u5c5e': '#12711c', '\u77ff\u91c7\u975e\u91d1\u5c5e': '#12711c', '\u79d1\u5b66\u7814\u7a76\u6280\u672f\u670d\u52a1': '#001c7f', '\u79d1\u5b78\u7814\u7a76': '#001c7f', '\u79df\u8cc3\u5546\u52d9': '#a23582', '\u7d21\u7e54\u54c1': '#3c3c3c', '\u885b\u751f\u793e\u6703\u5de5\u4f5c': '#591e71', '\u8fb2\u6797\u7267\u6f01': '#12711c', '\u8fd0\u8f93\u4ed3\u50a8\u90ae\u653f': '#b1400d', '\u901a\u4fe1\u7535\u5b50\u8bbe\u5907': '#8c0800', '\u901a\u7528\u8a2d\u5099': '#8c0800', '\u91c7\u77f3\u6cb9\u5929\u7136\u6c14': '#b8850a', '\u91c7\u9009\u7164\u70ad': '#b8850a', '\u91d1\u878d': '#a23582', '\u96fb\u6c23\u6a5f\u68b0\u5668\u6750': '#8c0800'}, 'en': {'Accommodation & catering': '#b1400d', 'Administration of water, environment & public facilities': '#006374', 'Agriculture, forestry, husbandry & fishery': '#12711c', 'Chemical manuf.': '#592f0d', 'Coal mining': '#b8850a', 'Construction': '#b1400d', 'Culture, sports & entertainment': '#591e71', 'Education': '#591e71', 'Electrical machinery & equipment': '#8c0800', 'Electronic & computer equipments': '#8c0800', 'Equipments, transport': '#8c0800', 'Finance': '#a23582', 'Food & tobacco processing': '#3c3c3c', 'Fuel processing': '#3c3c3c', 'Gas prod. & distr.': '#b8850a', 'Health care & social work': '#591e71', 'Information & software services': '#001c7f', 'Instruments, measurement': '#8c0800', 'Leasing and commercial services': '#a23582', 'Leather, fur & feather': '#592f0d', 'Machinery, general': '#8c0800', 'Machinery, specialized': '#8c0800', 'Metal manuf.': '#592f0d', 'Metal ores mining': '#12711c', 'Metal smelting & processing': '#3c3c3c', 'Non-metallic mineral manuf.': '#592f0d', 'Nonmetal and other ores mining': '#12711c', 'Other manuf.': '#592f0d', 'Other manuf. & recyclying': '#006374', 'Paper, printing and culture, education and sport items': '#592f0d', 'Petro & gas extraction': '#b8850a', 'Polytechnic services': '#001c7f', 'Power & heat prod. & distr.': '#b8850a', 'Public administration, social insurance & organizations': '#591e71', 'Real estate': '#a23582', 'Recyclying': '#006374', 'Repair of metal , machinery & equipment': '#006374', 'Resident, repair & other services': '#591e71', 'Scientific research': '#001c7f', 'Scientific research & Polytechnic services': '#001c7f', 'Tap water prod. & distr.': '#006374', 'Textile': '#3c3c3c', 'Timber & furniture': '#3c3c3c', 'Transport, storage & postal services': '#b1400d', 'Wholesale & retail': '#b1400d'}, 'zh_hans': {'\u4e13\u7528\u8bbe\u5907': '#8c0800', '\u4ea4\u901a\u8fd0\u8f93\u8bbe\u5907': '#8c0800', '\u4ea7\u4f9b\u6c34': '#006374', '\u4ea7\u4f9b\u71c3\u6c14': '#b8850a', '\u4ea7\u4f9b\u7535\u70ed\u529b': '#b8850a', '\u4eea\u5668\u4eea\u8868': '#8c0800', '\u4f4f\u5bbf\u9910\u996e': '#b1400d', '\u4fe1\u901a\u8f6f\u4ef6\u6280\u672f': '#001c7f', '\u4fee\u7406\u91d1\u673a\u8bbe\u5907': '#006374', '\u516c\u5171\u7ba1\u7406': '#591e71', '\u519c\u6797\u7267\u6e14': '#12711c', '\u5236\u5316\u5b66': '#592f0d', '\u5236\u670d\u978b\u5e3d\u76ae\u7fbd': '#592f0d', '\u5236\u7eb8\u5370\u5237\u6587\u6559': '#592f0d', '\u5236\u9020\u5176\u4ed6': '#592f0d', '\u5236\u9020\u5176\u4ed6\u56de\u6536': '#006374', '\u5236\u91d1\u5c5e\u5236\u54c1': '#592f0d', '\u5236\u975e\u91d1\u5c5e': '#592f0d', '\u52a0\u5de5\u6728\u6750\u5bb6\u5177': '#3c3c3c', '\u52a0\u5de5\u77f3\u6cb9\u7126\u6838': '#3c3c3c', '\u52a0\u5de5\u91d1\u5c5e\u51b6\u70bc': '#3c3c3c', '\u52a0\u5de5\u98df\u54c1\u70df\u8349': '#3c3c3c', '\u536b\u751f\u793e\u4f1a\u5de5\u4f5c': '#591e71', '\u56de\u6536': '#006374', '\u5c45\u6c11\u670d\u52a1\u4fee\u7406': '#591e71', '\u5efa\u7b51': '#b1400d', '\u623f\u5730\u4ea7': '#a23582', '\u6279\u53d1\u96f6\u552e': '#b1400d', '\u6280\u672f\u670d\u52a1': '#001c7f', '\u6559\u80b2': '#591e71', '\u6587\u5316\u4f53\u80b2\u5a31\u4e50': '#591e71', '\u6c34\u5229\u73af\u5883\u516c\u8bbe': '#006374', '\u7535\u6c14\u673a\u68b0\u5668\u6750': '#8c0800', '\u77ff\u91c7\u91d1\u5c5e': '#12711c', '\u77ff\u91c7\u975e\u91d1\u5c5e': '#12711c', '\u79d1\u5b66\u7814\u7a76': '#001c7f', '\u79d1\u5b66\u7814\u7a76\u6280\u672f\u670d\u52a1': '#001c7f', '\u79df\u8d41\u5546\u52a1': '#a23582', '\u7eba\u7ec7\u54c1': '#3c3c3c', '\u8fd0\u8f93\u4ed3\u50a8\u90ae\u653f': '#b1400d', '\u901a\u4fe1\u7535\u5b50\u8bbe\u5907': '#8c0800', '\u901a\u7528\u8bbe\u5907': '#8c0800', '\u91c7\u77f3\u6cb9\u5929\u7136\u6c14': '#b8850a', '\u91c7\u9009\u7164\u70ad': '#b8850a', '\u91d1\u878d': '#a23582'}}\n\nd_trans = {'code': {'2017new': '2017new', 'AH': 'AH', 'BJ': 'BJ', 'CQ': 'CQ', 'Check1': 'Check1', 'Check2': 'Check2', 'ERR': 'ERR', 'EX': 'EX', 'Edge': 'Edge', 'Export': 'Export', 'ExtraInput': 'ExtraInput', 'FJ': 'FJ', 'FU101': 'FU101', 'FU102': 'FU102', 'FU103': 'FU103', 'FU201': 'FU201', 'FU202': 'FU202', 'False': 'False', 'GD': 'GD', 'GO': 'GO', 'GS': 'GS', 'GX': 'GX', 'GZ': 'GZ', 'Gross Output': 'Gross Output', 'HA': 'HA', 'HB': 'HB', 'HE': 'HE', 'HI': 'HI', 'HL': 'HL', 'HN': 'HN', 'IM': 'IM', 'IfIntra': 'IfIntra', 'Indicator': 'Indicator', 'Industry': 'Industry', 'Input': 'Input', 'InputSum': 'InputSum', 'InputTotal': 'InputTotal', 'Input_short': 'Input_short', 'JL': 'JL', 'JS': 'JS', 'JX': 'JX', 'LN': 'LN', 'NM': 'NM', 'NX': 'NX', 'NetVis': 'NetVis', 'Node': 'Node', 'NodeIntra': 'NodeIntra', 'Output': 'Output', 'OutputSum': 'OutputSum', 'Output_short': 'Output_short', 'QH': 'QH', 'SC': 'SC', 'SD': 'SD', 'SH': 'SH', 'SN': 'SN', 'SX': 'SX', 'Sum': 'Sum', 'TFU': 'TFU', 'TI': 'TI', 'TII': 'TII', 'TJ': 'TJ', 'TVA': 'TVA', 'TopN': 'TopN', 'Total': 'Total', 'Total Final Use': 'Total Final Use', 'TrendVis': 'TrendVis', 'True': 'True', 'VA001': 'VA001', 'VA002': 'VA002', 'VA003': 'VA003', 'VA004': 'VA004', 'XJ': 'XJ', 'XZ': 'XZ', 'YN': 'YN', 'ZJ': 'ZJ', '_CIFU_': '_CIFU_', '_CIVA_': '_CIVA_', '_CI_': '_CI_', '_CO2_': '_CO2_', '_R69_': '_R69_', '_TFU_int_': '_TFU_int_', '_unit_CI_': '_unit_CI_', '_unit_CO2_': '_unit_CO2_', '_unit_currency_': '_unit_currency_', 'betweenness': 'betweenness', 'c1': 'c1', 'c10_11': 'c10_11', 'c12': 'c12', 'c13g': 'c13g', 'c13i': 'c13i', 'c13m': 'c13m', 'c13s': 'c13s', 'c14a': 'c14a', 'c14b': 'c14b', 'c15': 'c15', 'c16': 'c16', 'c16m': 'c16m', 'c16w': 'c16w', 'c17e': 'c17e', 'c17g': 'c17g', 'c17w': 'c17w', 'c18': 'c18', 'c19': 'c19', 'c20_21': 'c20_21', 'c22': 'c22', 'c23_26': 'c23_26', 'c27': 'c27', 'c28': 'c28', 'c29': 'c29', 'c2c': 'c2c', 'c2m': 'c2m', 'c2n': 'c2n', 'c2p': 'c2p', 'c3': 'c3', 'c30': 'c30', 'c31': 'c31', 'c32': 'c32', 'c33': 'c33', 'c34': 'c34', 'c35': 'c35', 'c4': 'c4', 'c5': 'c5', 'c6': 'c6', 'c7': 'c7', 'c8': 'c8', 'c9': 'c9', 'closeness_centrality': 'closeness_centrality', 'clustcoef': 'clustcoef', 'currentprice': 'currentprice', 'eigenvector': 'eigenvector', 'in_degree_centrality': 'in_degree_centrality', 'iso3166_2': 'iso3166_2', 'katz': 'katz', 'mcult': 'mcult', 'msci': 'msci', 'mscitech': 'mscitech', 'mtech': 'mtech', 'out_degree_centrality': 'out_degree_centrality', 'pagerank': 'pagerank', 'pctl': 'pctl', 'perc': 'perc', 'rank': 'rank', 'reg': 'reg', 'value': 'value', 'variable': 'variable', 'weight': 'weight', 'year': 'year'}, 'zh_hant': {'2017new': '2017\u65b0', 'AH': '\u5b89\u5fbd', 'BJ': '\u5317\u4eac', 'CQ': '\u91cd\u6176', 'Check1': '\u7e3d\u7522\u51fa\u68211', 'Check2': '\u7e3d\u7522\u51fa\u68212', 'ERR': '\u5176\u4ed6\u9805', 'EX': '\u51fa\u53e3', 'Edge': '\u93c8\u7d50', 'Export': 'ex\u51fa\u53e3', 'ExtraInput': 'ex\u6295\u5165', 'FJ': '\u798f\u5efa', 'FU101': '\u6d88\u8cbb(\u8fb2\u6751)', 'FU102': '\u6d88\u8cbb(\u57ce\u93ae)', 'FU103': '\u6d88\u8cbb(\u653f\u5e9c)', 'FU201': '\u56fa\u5b9a\u8cc7\u672c\u5f62\u6210', 'FU202': '\u5b58\u8ca8\u589e\u52a0', 'False': '\u5426', 'GD': '\u5ee3\u6771', 'GO': '\u7e3d\u7522\u51fa2', 'GS': '\u7518\u8085', 'GX': '\u5ee3\u897f', 'GZ': '\u8cb4\u5dde', 'Gross Output': '\u7e3d\u7522\u51fa', 'HA': '\u6cb3\u5357', 'HB': '\u6e56\u5317', 'HE': '\u6cb3\u5317', 'HI': '\u6d77\u5357', 'HL': '\u9ed1\u9f8d\u6c5f', 'HN': '\u6e56\u5357', 'IM': '\u9032\u53e3', 'IfIntra': '\u884c\u696d\u5185', 'Indicator': '\u6307\u6a19', 'Industry': '\u7522\u696d', 'Input': '\u6295\u5165', 'InputSum': '\u6295\u5165\u548c', 'InputTotal': '\u7e3d\u6295\u5165', 'Input_short': '\u5165', 'JL': '\u5409\u6797', 'JS': '\u6c5f\u8607', 'JX': '\u6c5f\u897f', 'LN': '\u907c\u5be7', 'NM': '\u5167\u8499\u53e4', 'NX': '\u5be7\u590f', 'NetVis': '\u7db2\u7d61\u7d50\u69cb\u53ef\u8996\u5316', 'Node': '\u7bc0\u9ede', 'NodeIntra': '\u7522\u696d\u5167', 'Output': '\u7522\u51fa', 'OutputSum': '\u7522\u51fa\u5408', 'Output_short': '\u51fa', 'QH': '\u9752\u6d77', 'SC': '\u56db\u5ddd', 'SD': '\u5c71\u6771', 'SH': '\u4e0a\u6d77', 'SN': '\u965d\u897f', 'SX': '\u5c71\u897f', 'Sum': '\u5408\u8a08', 'TFU': '\u6700\u7d42\u4f7f\u7528', 'TI': '\u7e3d\u6295\u5165', 'TII': '\u7e3d\u4e2d\u9593\u6295\u5165', 'TJ': '\u5929\u6d25', 'TVA': '\u589e\u52a0\u503c', 'TopN': '\u524dN', 'Total': '\u7e3d\u503c', 'Total Final Use': '\u4f7f\u7528\u5408\u8a08', 'TrendVis': '\u8da8\u52e2\u5206\u6790', 'True': '\u662f', 'VA001': '\u52de\u52d5\u8005\u5831\u916c', 'VA002': '\u751f\u7522\u7a05\u6de8\u984d', 'VA003': '\u56fa\u5b9a\u8cc7\u7522\u6298\u820a', 'VA004': '\u71df\u696d\u76c8\u4f59', 'XJ': '\u65b0\u7586', 'XZ': '\u897f\u85cf', 'YN': '\u96f2\u5357', 'ZJ': '\u6d59\u6c5f', '_CIFU_': '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTFU', '_CIVA_': '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTVA', '_CI_': '\u78b3\u6392\u5f37\u5ea6', '_CO2_': 'CO2\u6392\u653e', '_R69_': '\u7e3d\u7522\u51fa', '_TFU_int_': '\u4e2d\u9593\u4f7f\u7528\u5408\u8a08', '_unit_CI_': '\u5343\u514b\uff0f\u842c\u5143\u4eba\u6c11\u5e63', '_unit_CO2_': '\u767e\u842c\u516c\u5678', '_unit_currency_': '\u767e\u842c\u5143', 'betweenness': '\u4ecb\u4e2d\u5fc3\u6027', 'c1': '\u8fb2\u6797\u7267\u6f01', 'c10_11': '\u5236\u975e\u91d1\u5c5e', 'c12': '\u52a0\u5de5\u91d1\u5c5e\u51b6\u70bc', 'c13g': '\u901a\u7528\u8a2d\u5099', 'c13i': '\u5100\u5668\u5100\u8868', 'c13m': '\u5236\u91d1\u5c5e\u5236\u54c1', 'c13s': '\u5c08\u7528\u8a2d\u5099', 'c14a': '\u96fb\u6c23\u6a5f\u68b0\u5668\u6750', 'c14b': '\u901a\u4fe1\u7535\u5b50\u8bbe\u5907', 'c15': '\u4ea4\u901a\u904b\u8f38\u8a2d\u5099', 'c16': '\u5236\u9020\u5176\u4ed6\u56de\u6536', 'c16m': '\u5236\u9020\u5176\u4ed6', 'c16w': '\u56de\u6536', 'c17e': '\u4ea7\u4f9b\u7535\u70ed\u529b', 'c17g': '\u4ea7\u4f9b\u71c3\u6c14', 'c17w': '\u4ea7\u4f9b\u6c34', 'c18': '\u5efa\u7bc9', 'c19': '\u4fee\u7406\u91d1\u673a\u8bbe\u5907', 'c20_21': '\u6279\u767c\u96f6\u552e', 'c22': '\u4f4f\u5bbf\u9910\u98f2', 'c23_26': '\u8fd0\u8f93\u4ed3\u50a8\u90ae\u653f', 'c27': '\u4fe1\u901a\u8f6f\u4ef6\u6280\u672f', 'c28': '\u91d1\u878d', 'c29': '\u623f\u5730\u7522', 'c2c': '\u91c7\u9009\u7164\u70ad', 'c2m': '\u77ff\u91c7\u91d1\u5c5e', 'c2n': '\u77ff\u91c7\u975e\u91d1\u5c5e', 'c2p': '\u91c7\u77f3\u6cb9\u5929\u7136\u6c14', 'c3': '\u52a0\u5de5\u98df\u54c1\u70df\u8349', 'c30': '\u79df\u8cc3\u5546\u52d9', 'c31': '\u516c\u5171\u7ba1\u7406', 'c32': '\u6559\u80b2', 'c33': '\u885b\u751f\u793e\u6703\u5de5\u4f5c', 'c34': '\u6c34\u5229\u73af\u5883\u516c\u8bbe', 'c35': '\u5c45\u6c11\u670d\u52a1\u4fee\u7406', 'c4': '\u7d21\u7e54\u54c1', 'c5': '\u5236\u670d\u978b\u5e3d\u76ae\u7fbd', 'c6': '\u52a0\u5de5\u6728\u6750\u5bb6\u5177', 'c7': '\u5236\u7eb8\u5370\u5237\u6587\u6559', 'c8': '\u52a0\u5de5\u77f3\u6cb9\u7126\u6838', 'c9': '\u5236\u5316\u5b66', 'closeness_centrality': '\u89aa\u8fd1\u4e2d\u5fc3\u6027', 'clustcoef': '\u805a\u985e\u7cfb\u6578', 'currentprice': '\u767e\u842c\u7f8e\u5143', 'eigenvector': '\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', 'in_degree_centrality': '\u5165\u5ea6\u4e2d\u5fc3\u6027', 'iso3166_2': 'ISO\u78bc', 'katz': 'Katz\u4e2d\u5fc3\u6027', 'mcult': '\u6587\u5316\u4f53\u80b2\u5a31\u4e50', 'msci': '\u79d1\u5b78\u7814\u7a76', 'mscitech': '\u79d1\u5b66\u7814\u7a76\u6280\u672f\u670d\u52a1', 'mtech': '\u6280\u8853\u670d\u52d9', 'out_degree_centrality': '\u51fa\u5ea6\u4e2d\u5fc3\u6027', 'pagerank': 'Pagerank\u4e2d\u5fc3\u6027', 'pctl': '\u767e\u5206\u4f4d\u6392\u540d', 'perc': '\u767e\u5206\u6bd4', 'rank': '\u6392\u540d', 'reg': '\u5730\u57df', 'value': '\u503c', 'variable': '\u8b8a\u91cf', 'weight': '\u6b0a\u91cd', 'year': '\u5e74'}, 'en': {'2017new': '2017 new', 'AH': 'Anhui', 'BJ': 'Beijing', 'CQ': 'Chongqing', 'Check1': 'Proportion of errors in gross output (less than 5%)', 'Check2': 'Gross Output Check', 'ERR': 'ERR', 'EX': 'Exports', 'Edge': 'Edge', 'Export': 'Export', 'ExtraInput': 'ExtraInput', 'FJ': 'Fujian', 'FU101': 'Consumption (Rural)', 'FU102': 'Consumption (Urban)', 'FU103': 'Consumption (Gov.)', 'FU201': 'Fixed capital formation', 'FU202': 'Invetory change', 'False': 'False', 'GD': 'Guangdong', 'GO': 'Total2', 'GS': 'Gansu', 'GX': 'Guangxi', 'GZ': 'Guizhou', 'Gross Output': 'Gross Output', 'HA': 'Henan', 'HB': 'Hubei', 'HE': 'Hebei', 'HI': 'Hainan', 'HL': 'Heilongjiang', 'HN': 'Hunan', 'IM': 'Imports', 'IfIntra': 'Internal', 'Indicator': 'Indicator', 'Industry': 'Sector', 'Input': 'Input', 'InputSum': 'Input Sum', 'InputTotal': 'InputTotal', 'Input_short': 'In', 'JL': 'Jilin', 'JS': 'Jiangsu', 'JX': 'Jiangxi', 'LN': 'Liaoning', 'NM': 'Inner Mongolia', 'NX': 'Ningxia', 'NetVis': 'Network Structure Visualization', 'Node': 'Node', 'NodeIntra': 'Intra-Industry', 'Output': 'Output', 'OutputSum': 'OutputSum', 'Output_short': 'Out', 'QH': 'Qinghai', 'SC': 'Sichuan', 'SD': 'Shandong', 'SH': 'Shanghai', 'SN': 'Shaanxi', 'SX': 'Shanxi', 'Sum': 'Sum', 'TFU': 'Final consumption', 'TI': 'Input Total', 'TII': 'Intermediate input total', 'TJ': 'Tianjin', 'TVA': 'Value added at basic prices', 'TopN': 'Top N \u2026', 'Total': 'Total', 'Total Final Use': 'Total Final Use', 'TrendVis': 'Trend Analysis', 'True': 'True', 'VA001': 'Labor compensation', 'VA002': 'Taxes less subsidies on products', 'VA003': 'Depreciation of fixed assets', 'VA004': 'Operation profit', 'XJ': 'Xinjiang', 'XZ': 'Tibet', 'YN': 'Yunnan', 'ZJ': 'Zhejiang', '_CIFU_': 'Carbon intensity (per TFU) ', '_CIVA_': 'Carbon intensity (per TVA) ', '_CI_': 'Carbon intensity', '_CO2_': 'CO2', '_R69_': 'Total', '_TFU_int_': 'Total intermediate use', '_unit_CI_': 'kg/10,000\xa5', '_unit_CO2_': 'million tons', '_unit_currency_': '\xa5 million', 'betweenness': 'Betweenness', 'c1': 'Agriculture, forestry, husbandry & fishery', 'c10_11': 'Non-metallic mineral manuf.', 'c12': 'Metal smelting & processing', 'c13g': 'Machinery, general', 'c13i': 'Instruments, measurement', 'c13m': 'Metal manuf.', 'c13s': 'Machinery, specialized', 'c14a': 'Electrical machinery & equipment', 'c14b': 'Electronic & computer equipments', 'c15': 'Equipments, transport', 'c16': 'Other manuf. & recyclying', 'c16m': 'Other manuf.', 'c16w': 'Recyclying', 'c17e': 'Power & heat prod. & distr.', 'c17g': 'Gas prod. & distr.', 'c17w': 'Tap water prod. & distr.', 'c18': 'Construction', 'c19': 'Repair of metal , machinery & equipment', 'c20_21': 'Wholesale & retail', 'c22': 'Accommodation & catering', 'c23_26': 'Transport, storage & postal services', 'c27': 'Information & software services', 'c28': 'Finance', 'c29': 'Real estate', 'c2c': 'Coal mining', 'c2m': 'Metal ores mining', 'c2n': 'Nonmetal and other ores mining', 'c2p': 'Petro & gas extraction', 'c3': 'Food & tobacco processing', 'c30': 'Leasing and commercial services', 'c31': 'Public administration, social insurance & organizations', 'c32': 'Education', 'c33': 'Health care & social work', 'c34': 'Administration of water, environment & public facilities', 'c35': 'Resident, repair & other services', 'c4': 'Textile', 'c5': 'Leather, fur & feather', 'c6': 'Timber & furniture', 'c7': 'Paper, printing and culture, education and sport items', 'c8': 'Fuel processing', 'c9': 'Chemical manuf.', 'closeness_centrality': 'Closeness Centrality', 'clustcoef': 'Clustering coefficient', 'currentprice': '$ million', 'eigenvector': 'Eigenvector', 'in_degree_centrality': 'In-degree Centrality', 'iso3166_2': 'ISO Code', 'katz': 'Katz', 'mcult': 'Culture, sports & entertainment', 'msci': 'Scientific research', 'mscitech': 'Scientific research & Polytechnic services', 'mtech': 'Polytechnic services', 'out_degree_centrality': 'Out-degree Centrality', 'pagerank': 'PageRank', 'pctl': 'Percentile', 'perc': 'Percentage', 'rank': 'Rank', 'reg': 'Region', 'value': 'value', 'variable': 'Variable', 'weight': 'Edge weight', 'year': 'Year'}, 'zh_hans': {'2017new': '2017\u65b0', 'AH': '\u5b89\u5fbd', 'BJ': '\u5317\u4eac', 'CQ': '\u91cd\u5e86', 'Check1': '\u603b\u4ea7\u51fa\u6821\u9a8c1', 'Check2': '\u603b\u4ea7\u51fa\u6821\u9a8c2', 'ERR': '\u5176\u4ed6\u9879', 'EX': '\u51fa\u53e3', 'Edge': '\u8fb9\u7f18', 'Export': 'ex\u51fa\u53e3', 'ExtraInput': 'ex\u6295\u5165', 'FJ': '\u798f\u5efa', 'FU101': '\u6d88\u8d39(\u519c\u6751)', 'FU102': '\u6d88\u8d39(\u57ce\u9547)', 'FU103': '\u6d88\u8d39(\u653f\u5e9c)', 'FU201': '\u56fa\u5b9a\u8d44\u672c\u5f62\u6210', 'FU202': '\u5b58\u8d27\u589e\u52a0', 'False': '\u5426', 'GD': '\u5e7f\u4e1c', 'GO': '\u603b\u4ea7\u51fa2', 'GS': '\u7518\u8083', 'GX': '\u5e7f\u897f', 'GZ': '\u8d35\u5dde', 'Gross Output': '\u603b\u4ea7\u51fa', 'HA': '\u6cb3\u5357', 'HB': '\u6e56\u5317', 'HE': '\u6cb3\u5317', 'HI': '\u6d77\u5357', 'HL': '\u9ed1\u9f99\u6c5f', 'HN': '\u6e56\u5357', 'IM': '\u8fdb\u53e3', 'IfIntra': '\u884c\u4e1a\u5185', 'Indicator': '\u6307\u6807', 'Industry': '\u4ea7\u4e1a', 'Input': '\u6295\u5165', 'InputSum': '\u6295\u5165\u548c', 'InputTotal': '\u603b\u6295\u5165', 'Input_short': '\u5165', 'JL': '\u5409\u6797', 'JS': '\u6c5f\u82cf', 'JX': '\u6c5f\u897f', 'LN': '\u8fbd\u5b81', 'NM': '\u5185\u8499\u53e4', 'NX': '\u5b81\u590f', 'NetVis': '\u7f51\u7edc\u7ed3\u6784\u53ef\u89c6\u5316', 'Node': '\u8282\u70b9', 'NodeIntra': '\u4ea7\u4e1a\u5185', 'Output': '\u4ea7\u51fa', 'OutputSum': '\u4ea7\u51fa\u5408', 'Output_short': '\u51fa', 'QH': '\u9752\u6d77', 'SC': '\u56db\u5ddd', 'SD': '\u5c71\u4e1c', 'SH': '\u4e0a\u6d77', 'SN': '\u9655\u897f', 'SX': '\u5c71\u897f', 'Sum': '\u5408\u8ba1', 'TFU': '\u6700\u7ec8\u4f7f\u7528', 'TI': '\u603b\u6295\u5165', 'TII': '\u603b\u4e2d\u95f4\u6295\u5165', 'TJ': '\u5929\u6d25', 'TVA': '\u589e\u52a0\u503c', 'TopN': '\u524dN', 'Total': '\u603b\u503c', 'Total Final Use': '\u4f7f\u7528\u5408\u8ba1', 'TrendVis': '\u8d8b\u52bf\u5206\u6790', 'True': '\u662f', 'VA001': '\u52b3\u52a8\u8005\u62a5\u916c', 'VA002': '\u751f\u4ea7\u7a0e\u51c0\u989d', 'VA003': '\u56fa\u5b9a\u8d44\u4ea7\u6298\u65e7', 'VA004': '\u8425\u4e1a\u76c8\u4f59', 'XJ': '\u65b0\u7586', 'XZ': '\u897f\u85cf', 'YN': '\u4e91\u5357', 'ZJ': '\u6d59\u6c5f', '_CIFU_': '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTFU', '_CIVA_': '\u78b3\u6392\u5f3a\u5ea6-\u6bcfTVA', '_CI_': '\u78b3\u6392\u5f3a\u5ea6', '_CO2_': 'CO2\u6392\u653e', '_R69_': '\u603b\u4ea7\u51fa', '_TFU_int_': '\u4e2d\u95f4\u4f7f\u7528\u5408\u8ba1', '_unit_CI_': '\u5343\u514b\uff0f\u4e07\u5143\u4eba\u6c11\u5e01', '_unit_CO2_': '\u767e\u4e07\u516c\u5428', '_unit_currency_': '\u767e\u4e07\u5143', 'betweenness': '\u4ecb\u4e2d\u5fc3\u6027', 'c1': '\u519c\u6797\u7267\u6e14', 'c10_11': '\u5236\u975e\u91d1\u5c5e', 'c12': '\u52a0\u5de5\u91d1\u5c5e\u51b6\u70bc', 'c13g': '\u901a\u7528\u8bbe\u5907', 'c13i': '\u4eea\u5668\u4eea\u8868', 'c13m': '\u5236\u91d1\u5c5e\u5236\u54c1', 'c13s': '\u4e13\u7528\u8bbe\u5907', 'c14a': '\u7535\u6c14\u673a\u68b0\u5668\u6750', 'c14b': '\u901a\u4fe1\u7535\u5b50\u8bbe\u5907', 'c15': '\u4ea4\u901a\u8fd0\u8f93\u8bbe\u5907', 'c16': '\u5236\u9020\u5176\u4ed6\u56de\u6536', 'c16m': '\u5236\u9020\u5176\u4ed6', 'c16w': '\u56de\u6536', 'c17e': '\u4ea7\u4f9b\u7535\u70ed\u529b', 'c17g': '\u4ea7\u4f9b\u71c3\u6c14', 'c17w': '\u4ea7\u4f9b\u6c34', 'c18': '\u5efa\u7b51', 'c19': '\u4fee\u7406\u91d1\u673a\u8bbe\u5907', 'c20_21': '\u6279\u53d1\u96f6\u552e', 'c22': '\u4f4f\u5bbf\u9910\u996e', 'c23_26': '\u8fd0\u8f93\u4ed3\u50a8\u90ae\u653f', 'c27': '\u4fe1\u901a\u8f6f\u4ef6\u6280\u672f', 'c28': '\u91d1\u878d', 'c29': '\u623f\u5730\u4ea7', 'c2c': '\u91c7\u9009\u7164\u70ad', 'c2m': '\u77ff\u91c7\u91d1\u5c5e', 'c2n': '\u77ff\u91c7\u975e\u91d1\u5c5e', 'c2p': '\u91c7\u77f3\u6cb9\u5929\u7136\u6c14', 'c3': '\u52a0\u5de5\u98df\u54c1\u70df\u8349', 'c30': '\u79df\u8d41\u5546\u52a1', 'c31': '\u516c\u5171\u7ba1\u7406', 'c32': '\u6559\u80b2', 'c33': '\u536b\u751f\u793e\u4f1a\u5de5\u4f5c', 'c34': '\u6c34\u5229\u73af\u5883\u516c\u8bbe', 'c35': '\u5c45\u6c11\u670d\u52a1\u4fee\u7406', 'c4': '\u7eba\u7ec7\u54c1', 'c5': '\u5236\u670d\u978b\u5e3d\u76ae\u7fbd', 'c6': '\u52a0\u5de5\u6728\u6750\u5bb6\u5177', 'c7': '\u5236\u7eb8\u5370\u5237\u6587\u6559', 'c8': '\u52a0\u5de5\u77f3\u6cb9\u7126\u6838', 'c9': '\u5236\u5316\u5b66', 'closeness_centrality': '\u4eb2\u8fd1\u4e2d\u5fc3\u6027', 'clustcoef': '\u805a\u7c7b\u7cfb\u6570', 'currentprice': '\uff08\u767e\u4e07\u5143\uff09', 'eigenvector': '\u7279\u5f81\u5411\u91cf\u4e2d\u5fc3\u6027', 'in_degree_centrality': '\u5165\u5ea6\u4e2d\u5fc3\u6027', 'iso3166_2': 'ISO\u5730\u57df\u7801', 'katz': 'Katz\u4e2d\u5fc3\u6027', 'mcult': '\u6587\u5316\u4f53\u80b2\u5a31\u4e50', 'msci': '\u79d1\u5b66\u7814\u7a76', 'mscitech': '\u79d1\u5b66\u7814\u7a76\u6280\u672f\u670d\u52a1', 'mtech': '\u6280\u672f\u670d\u52a1', 'out_degree_centrality': '\u51fa\u5ea6\u4e2d\u5fc3\u6027', 'pagerank': 'PageRank', 'pctl': '\u767e\u5206\u4f4d\u6392\u540d', 'perc': '\u767e\u5206\u6bd4', 'rank': '\u6392\u540d', 'reg': '\u5730\u57df', 'value': '\u503c', 'variable': '\u53d8\u91cf', 'weight': '\u6743\u91cd', 'year': '\u5e74'}}    \n\n# In[15]:\n\n\n\n# #### CX. UI_label\n\n# In[16]:\n\n\nUI_label = {\n    'zh': {\n        "DashboardTitle": '\u4e2d\u56fd\u5404\u7701\u5404\u884c\u4e1a\u8131\u78b3\u8def\u7ebf\uff1a\u6295\u5165\u4ea7\u51fa\u7f51\u7edc\u4eea\u8868\u76d8',\n        "url_prj-visNetZero": "https://oxon8.netlify.app/visualization/prj-visNetZero/index.zh",\n        'Select year': '\u9009\u62e9\u5e74\u4efd',\n        'Select region': '\u9009\u62e9\u5730\u533a',\n        'Input region autocomplete': '\u8f93\u5165\u5730\u533a\uff08\u81ea\u52a8\u8865\u9f50\uff09',\n        'Select main indicator': '\u9009\u62e9\u6307\u6807\uff08\u4e3b\u8981\uff09',\n        'Select secondary indicator': '\u9009\u62e9\u6307\u6807\uff08\u6b21\u8981\uff09',\n        'Select any indicator': '\u9009\u62e9\u6307\u6807\uff08\u4efb\u9009\uff09',\n        'Node': '\u884c\u4e1a\uff1a\u8282\u70b9',\n        'Edge': '\u884c\u4e1a\u95f4\u6295\u5165\u4ea7\u51fa\uff1a\u8fb9\u7f18',\n        'Main': '\u4e3b\u8981',\n        'Secondary': '\u6b21\u8981',\n        'Any': '\u4efb\u9009',\n        "fTab Node Description": "\u6b64\u5904\u8ba1\u6709 {N_indicators_available} (\u539f\u6570\u636e\u5171 {N_indicators}) \u6307\u6807\uff0c\u5bf9\u4ea7\u4e1a\u7684\u4ea7\u503c\u53ca\u73af\u5883\u5f71\u54cd\u8fdb\u884c\u63a2\u7a76\u6bd4\u8f83\u3002",\n        "fTab Edge Description": "\u6b64\u5904\u5217\u51fa\u6700\u9ad8\u6295\u5165\u4ea7\u51fa\u5173\u7cfb\uff0c\u80fd\u5bf9\u8be5\u5730\u533a\u4e3b\u8981\u4ea7\u4e1a\u95f4\u6d3b\u52a8\u8fdb\u884c\u63a2\u7a76\u6bd4\u8f83\uff0c\u5171\uff1a",\n        "### Explore a year and place": "### \u6bd4\u8f83\u5404\u65f6\u533a\u5404\u5e74\u4efd",\n        "### Focus a main indicator": "### \u805a\u7126\u63a2\u7d22\u4e3b\u8981\u6307\u6807",\n        "### Adjust the network": "### \u8c03\u6574\u7f51\u7edc\u53c2\u6570",\n        "Visualization parameters": "\u8c03\u6574\u53ef\u89c6\u5316\u53c2\u6570",\n        "Slider Gravity": '\u5f15\u529b\u8c03\u8bd5',\n        "Slider Repulsion": '\u65a5\u529b\u8c03\u8bd5',\n        "Interactivity Tips": "\u6570\u636e\u4eea\u8868\u76d8\u4ea4\u4e92\u529f\u80fd\u8bf4\u660e",\n    },\n    'en': {\n        "DashboardTitle": 'Decarbonizaton roadmap for Chinese industries and provinces\uff1aInput-Output Network Dashboard',\n        "url_prj-visNetZero": "https://oxon8.netlify.app/en/visualization/prj-visNetZero/index.en",\n        'Select year': 'Select year',\n        'Select region': 'Select region',\n        'Input region autocomplete': 'Input region (autocomplete)',\n        'Select main indicator': 'Select indicator (main)',\n        'Select secondary indicator': 'Select indicator (secondary)',\n        'Select any indicator': 'Select indicator (any)',\n        'Node': 'Industry--Node',\n        'Edge': 'Industry In/Output--Edge',\n        'Main': 'Main',\n        'Secondary': 'Secondary',\n        'Any': 'Any',\n        "fTab Node Description": "There are {N_indicators_available} (out of {N_indicators}) made available here. Please compare the financial and environmental impacts of industries.",\n        "fTab Edge Description": "\u6b64\u5904\u5217\u51fa\u524d {N_edges} \u9ad8\u7684\u6295\u5165\u4ea7\u51fa\u503c\uff0c\u80fd\u5bf9\u8be5\u5730\u533a\u4e3b\u8981\u4ea7\u4e1a\u95f4\u6d3b\u52a8\u8fdb\u884c\u63a2\u7a76\u6bd4\u8f83\u3002",\n        "### Explore an year and place": "### Explore an year and place",\n        "### Adjust the network": "### Adjust the network",\n        "Visualization parameters": "Visualization parameters",\n        "Slider Gravity": 'Adjust gravity',\n        "Slider Repulsion": 'Adjust repulsion',\n        "Interactivity Tips": "Interactivity Tips",\n    },\n}\n\nUI_label['zh_hans'] = { k:v for k,v in UI_label['zh'].items() }\nUI_label['zh_hans']\n\n\n# In[17]:\n\n\nUI_label[locale]['Select year']\n\n\n# In[18]:\n\n# ## fstring\n\n# In[19]:\n\n\ndef convert_further_anyway(fstring_text, debug=False):\n    if "</style>" in fstring_text:\n        fstring_text_CSS_block  = fstring_text.split("</style>")[0] + "</style>"\n        fstring_text_to_process = fstring_text.split("</style>")[1] + "</style>"\n        return fstring_text_CSS_block + eval(f'f"""{fstring_text_to_process}"""')\n    else:\n        fstring_text_to_process = fstring_text\n        return eval(f'f"""{fstring_text_to_process}"""')\n# ---------------------------------------------------------------------------------\n\n\n# In[20]:\n\n\nIndicators_with_ttips = list ( dfN_locale [ ~dfN_locale.ttips.isna() ].index.unique(level='Indicator') )\nIndicators_Main = Indicators_with_ttips\nIndicators_Main\n\n\n# In[21]:\n\n\nIndicators_Secondary = [x for x in sel_indicators_list[locale] if x not in Indicators_Main]\nprint (Indicators_Secondary)\n\n\n# In[22]:\n\n\nprint ( sel_indicators_list[locale] )\n\n\n# # Elaborate App\n# \n\n# In[23]:\n\n\n### Modules required\nimport panel as pn\npn.extension('echarts')  # ECharts\nimport pandas as pd\nimport hvplot.pandas\nimport param\n\nimport pyecharts.options as opts\nfrom pyecharts.charts import Graph\n\n\n# ## preparations for class CEADsExplorer\n# ### list of stuff\n\n# In[24]:\n\n\nN_indicators_available, N_indicators  = len(sel_indicators_list[locale]), len(all_indicators_list[locale])\nN_indicators, N_indicators_available\n\n\n# In[25]:\n\n\n# checklists\n\n\n# similar: first two ['reg', 'year']\n# different: last two ['Indicator', 'Node'] -- ['Input', 'Output']\n# dfN : r, y, i, n\n# dfE : r, y, ei, eo\ndfN_locale.index.names, dfE_locale.index.names\n\n\n# In[26]:\n\n\ndfE_locale.columns\n\n\n# ### Numberformatter for tabulator\n# * dfN_locale/dfN:\n#     * percentage: 'pctl' 'perc'\n#     * complex (indicator based): 'value'\n\n# In[27]:\n\n\n# code reuse: tabulator + NumberFormatter\nfrom bokeh.models.widgets.tables import NumberFormatter, BooleanFormatter\npn.extension('tabulator')\n\ndef generate_bokeh_formatters (columns_fmtstr,  d_trans=d_trans, locale=locale):\n    bokeh_formatters = { d_trans[locale][k]: NumberFormatter(format=format_str) for k, format_str in columns_fmtstr.items() }\n    return bokeh_formatters\n\ncol_fmt_dict = {"value":'0,0.000',"perc":'0.00%',"pctl":'0.00%'}\ncol_fmt_dict_bokeh = generate_bokeh_formatters(col_fmt_dict)\n# to be used at  pn.widgets.Tabulator(TBL, formatters=col_fmt_dict_bokeh, ...\ncol_fmt_dict_bokeh\n\n\n# In[28]:\n\n\ndfE_locale.loc[:,'IfIntra'].astype(str).map(d_trans[locale])\n\n\n# In[29]:\n\n\ndfE_locale.loc[:,'IfIntra']=dfE_locale.loc[:,'IfIntra'].astype(str).map(d_trans[locale])\n\n\n# ## class CEADsExplorer\n\n# In[30]:\n\n\nclass CEADsExplorer(param.Parameterized):\n    ## Data directly initiated and load\n    sel_reg_localeJ = param.Selector(objects=reg_dict_UI_joint )#reg_all [locale] )   \n    sel_year_locale = param.Selector(objects=year_all [locale]) \n    sel_indicator_main      = param.Selector(objects=Indicators_Main)\n    sel_indicator_secondary = param.Selector(objects=Indicators_Secondary)\n    sel_indicator_tertiary  = param.Selector(objects=sel_indicators_list[locale])  \n    # class atrributes: dfN; dfE; sel_reg_localeJ; sel_year_locale; sel_indicator_main   all param!\n    ## Data directly initiated and load\n    dfN = param.DataFrame(dfN_locale.sort_index() )  # wrapped with param\n    dfE = param.DataFrame(dfE_locale.sort_index() )  # wrapped with param\n    \n    # define action model \n    # TBA: tabulator selection \n    #   selectable = 'checkbox', selection = []\n    def translate_df_columns (self, df, d_trans=d_trans, locale=locale):\n        return (df.rename (columns=d_trans[locale]))\n    def widget_Tabulator_wrapper (self, df, NorE = "N"):\n        if NorE == "N":\n            tabulator_filters = {\n                '\u8282\u70b9': {'type': 'list', 'func': 'in', 'valuesLookup': True, 'sort': 'asc', 'multiselect': True},\n                '\u503c':  {'type': 'number', 'func': '>=', 'placeholder': '\u8f93\u5165\u6700\u5c0f\u503c\u8fc7\u6ee4'},\n            }\n            TBL = pn.widgets.Tabulator (df, show_index=False, pagination='local', page_size=Tabulator_page_size, theme = "fast", \n                                    formatters=col_fmt_dict_bokeh, text_align="right",\n                                    header_filters=tabulator_filters)\n        elif NorE == "E":\n            tabulator_filters = {\n                '\u6295\u5165': {'type': 'list', 'func': 'in', 'valuesLookup': True, 'sort': 'asc', 'multiselect': True},\n                '\u4ea7\u51fa': {'type': 'list', 'func': 'in', 'valuesLookup': True, 'sort': 'asc', 'multiselect': True},\n                '\u884c\u4e1a\u5185': {'type': 'list', 'func': 'in', 'valuesLookup': True, 'multiselect': True},\n                '\u503c':  {'type': 'number', 'func': '>=', 'placeholder': '\u8f93\u5165\u6700\u5c0f\u503c\u8fc7\u6ee4'},\n            }\n            TBL = pn.widgets.Tabulator (df, show_index=False, pagination='local', page_size=Tabulator_page_size, theme = "fast", \n                                    formatters=col_fmt_dict_bokeh, text_align="right",\n                                    header_filters=tabulator_filters )\n        return TBL\n    \n    def process_param_r (self, r):\n        try:\n            reg = r.split(':')[1]\n        except:\n            reg = r\n        return (reg)\n\n    def get_df (self, r, y, i=slice(None), n=slice(None),\n                            ei=slice(None), eo=slice(None), NorE = "N"):\n        # processing r\n        reg = self.process_param_r (r)\n        if NorE == "N":\n            df = self.dfN.loc[(reg,y,n,i),:].reset_index()\\\n                         .sort_values('value', ascending=False)\n        elif NorE == "E":\n            df = self.dfE.loc[(reg,y,ei,eo),:].reset_index()\\\n                         .sort_values('value', ascending=False)\n        return  df\n    \n    def get_df_len (self, r, y, i=slice(None), n=slice(None),\n                            ei=slice(None), eo=slice(None), NorE = "N"):\n        df = self.get_df(r=r,y=y,i=i,n=n,ei=ei,eo=eo,NorE=NorE)         \n        return  len(df)\n    \n    def get_df_with_col_translated ( self, r, y, \n                                     i=slice(None), n=slice(None), ei=slice(None), eo=slice(None),\n                                     actions=["TBL_N_remove_cols","translate"], NorE = "N"):\n        # get datasource        \n        df = self.get_df (r,y,i=i,n=n,ei=ei,eo=eo, NorE = NorE)\n        # process actions\n        if "TBL_N_remove_cols" in actions:\n            ## clean up two columns for Tabulator\n            df = df.drop(['weight','ttips'], axis=1) \n        if "TBL_E_remove_cols" in actions:\n            ## clean up one column for Tabulator\n            df = df.drop(['weight'], axis=1) \n        if "translate" in actions:\n            df = self.translate_df_columns (df)\n        return  df\n        \n    def get_TBL (self, r, y, i=slice(None), n=slice(None), ei=slice(None), eo=slice(None), NorE = "N"):\n        if NorE == "N":\n            df = self.get_df_with_col_translated (r,y,i=i,n=n,ei=ei,eo=eo, actions= ["TBL_N_remove_cols","translate"], NorE = NorE)\n            TBL = self.widget_Tabulator_wrapper (df, NorE = NorE )\n        elif NorE == "E":\n            df = self.get_df_with_col_translated (r,y,i=i,n=n,ei=ei,eo=eo, actions= ["TBL_E_remove_cols","translate"], NorE = NorE)\n            TBL = self.widget_Tabulator_wrapper (df, NorE = NorE )\n        return  TBL\n\nmyExplorer = CEADsExplorer()\n\n\n# ## Panel outline and design\n\n# ### Layout_width defined for pn.template.FastGridTemplate\n\n# In[31]:\n\n\n### Layout_width\nLayout_width = {"en":{"sidebar":250, "OverlayMain":790, "Echart":1000, "Selector_default":200,\n                      "Tabulator_column_width":165, 'Tabulator_column_width_IndicatorsAcross':  [200, 135, 85, 90,90, 135, 85] },\n                "zh_hans":{"sidebar":240, "OverlayMain":800, "Echart":1000, "Selector_default":200, \n                      "Tabulator_column_width":105, 'Tabulator_column_width_IndicatorsAcross':  [180, 90, 80,  90,90,  90, 80] }\n               }\n\n### Tabulator Size\nTabulator_page_size = 10\n\n# wider for locale en\n\n\n# ### Sidebar\n\n# In[32]:\n\n\nmd_Interactivity_Tips ="""\n1. ***\u9f20\u6807\u60ac\u6d6e(hover)***\u7f51\u7edc**\u8282\u70b9\u53ca\u8fb9\u7f18**\uff0c\u53ef\u89c1\u5b9e\u9645\u6570\u636e\u4fe1\u606f\u3002\n2. ***\u8c03\u6574***\u4e3b\u56fe**\u89c6\u56fe\u754c\u9650**\uff0c\u8bf7\u5229\u7528\u4e3b\u56fe\u4e0b\u65b9\u7684**\u8303\u56f4\u9009\u62e9\u5668**\uff0c\u6216\u4f7f\u7528\u53f3\u65b9\u7684**\u653e\u5927\u53ca\u62d6\u62fd\u5de5\u5177**\n3. ***\u6392\u5e8f***\u9644\u8868**\u6570\u636e\u5927\u5c0f**\uff0c\u5404\u8868\u683c\u7684\u5404\u884c\u6570\u636e\u5747\u53ef\u70b9\u51fb\u6309**\u5927\u81f3\u5c0f**\u6216**\u5c0f\u81f3\u5927**\u6392\u5e8f\n4. \u5404\u4e3b\u56fe\u53ca\u9644\u8868\u5747\u53ef\u8c03\u6574\uff1a\n    * \u7a97\u53e3**\u5927\u5c0f**\uff08\u81f3\u53f3\u4e0b\u89d2\u6309\u53d6**\u8c03\u6574**\u63a7\u4ef6\uff09\n    * **\u5168\u5c4f**\u7a97\u53e3\uff08\u81f3\u53f3\u4e0a\u89d2\u6309\u53d6**\u5168\u5c4f**\u63a7\u4ef6\uff09\n    * \u7a97\u53e3**\u4f4d\u7f6e**\uff08\u81f3\u5de6\u4e0a\u89d2\u6309\u53d6**\u62d6\u62fd**\u63a7\u4ef6\uff095. \n6. ***\u8fc7\u6ee4\u6bd4\u8f83*** \u5404\u9644\u8868\u6570\u636e\uff0c\u53ef\u89c1\u5b9e\u9645\u6570\u636e\u4fe1\u606f\n---\n\u2764\ufe0f\u611f\u8c22Python\u5f00\u6e90\u6570\u636e\u53ef\u89c6\u5316\u9879\u76ee[Holoviz](https://holoviz.org/about.html)\u53ca\u6570\u636e\u5206\u6790\u9879\u76ee[pandas](https://pandas.pydata.org/)\u53ca [scipy](https://scipy.org/)\u3002\n"""\n\n\n# In[33]:\n\n\n### Parameters actualized\n## Widgets: year, regX2, indicator\n# reg\nwidget_reg_select        = pn.widgets.Select.from_param ( myExplorer.param["sel_reg_localeJ"], \n    width=Layout_width[locale][ "Selector_default"], name=UI_label[locale]['Select region'])\nwidget_reg_autocomplete  = pn.widgets.AutocompleteInput.from_param ( myExplorer.param["sel_reg_localeJ"], \n    width=Layout_width[locale][ "Selector_default"], name=UI_label[locale]['Input region autocomplete'], case_sensitive=False, search_strategy='includes', min_characters=1,\n    placeholder='GD')\n# year\nwidget_year_slider = pn.widgets.DiscreteSlider.from_param ( myExplorer.param.sel_year_locale, \n    width=Layout_width[locale][ "Selector_default"], name=UI_label[locale]['Select year'], value=reg_all [locale][0])\n# indicator\nwidget_indicator_main_sel= pn.widgets.Select.from_param ( myExplorer.param["sel_indicator_main"], \n    width=Layout_width[locale][ "Selector_default"], name=UI_label[locale]['Select main indicator'], value=Indicators_Main[0])\nwidget_indicator_secondary_sel= pn.widgets.Select.from_param ( myExplorer.param["sel_indicator_secondary"], \n    width=Layout_width[locale][ "Selector_default"], name=UI_label[locale]['Select secondary indicator'], value=Indicators_Secondary[0])\nwidget_indicator_tertiary_sel= pn.widgets.Select.from_param ( myExplorer.param["sel_indicator_tertiary"], \n    width=Layout_width[locale][ "Selector_default"], name=UI_label[locale]['Select any indicator'], value=Indicators_Secondary[-3])\n\n# Graph\nwg_slider_gravity   = pn.widgets.FloatSlider(name=UI_label[locale]['Slider Gravity'], \n                                             width=Layout_width[locale][ "Selector_default"],\n                                             #width = int(Layout_width[locale]["Echart"] *.45),\n                                             start=0.05, end=.95, step=0.05, value=0.7)\nwg_slider_repulsion = pn.widgets.IntSlider  (name=UI_label[locale]['Slider Repulsion'], \n                                             width=Layout_width[locale][ "Selector_default"],\n                                             #width = int(Layout_width[locale]["Echart"] *.45),\n                                             start=100, end=2000, step=100, value=1700)\n\n# Widgets Bind\nTBL_E_interactive = pn.bind( myExplorer.get_TBL, \n                       r=myExplorer.param.sel_reg_localeJ, \n                       y=myExplorer.param.sel_year_locale,\n                       #ei=slice(None), eo=slice(None), \n                       NorE = "E"                            \n                     )\nTBL_N_interactive_01 = pn.bind( myExplorer.get_TBL, \n                       r=myExplorer.param.sel_reg_localeJ, \n                       y=myExplorer.param.sel_year_locale,\n                       i=myExplorer.param.sel_indicator_main,\n                     )\nTBL_N_interactive_02 = pn.bind( myExplorer.get_TBL, \n                       r=myExplorer.param.sel_reg_localeJ, \n                       y=myExplorer.param.sel_year_locale,\n                       i=myExplorer.param.sel_indicator_secondary,\n                     )\nTBL_N_interactive_03 = pn.bind( myExplorer.get_TBL, \n                       r=myExplorer.param.sel_reg_localeJ, \n                       y=myExplorer.param.sel_year_locale,\n                       i=myExplorer.param.sel_indicator_tertiary,\n                     )\n\npn_sidebar = pn.Column( UI_label[locale]["### Explore a year and place"],\n                        widget_year_slider, widget_reg_select, widget_reg_autocomplete, \n                        pn.layout.Divider(),\n                        UI_label[locale]["### Focus a main indicator"],\n                        widget_indicator_main_sel,\n                        pn.layout.Divider(),\n                        UI_label[locale]["### Adjust the network"],\n                        pn.pane.Str(UI_label[locale]["Visualization parameters"]),\n                        wg_slider_gravity, wg_slider_repulsion, \n                        pn.Accordion( objects = [ pn.pane.Markdown (md_Interactivity_Tips, name=UI_label[locale]["Interactivity Tips"])] ),\n  margin = 0,\n)\n\npn_sidebar\n\n\n# ### Tabs: Data Nodes/Edges\n\n# #### Widget Tabs:  CSS styles\n\n# In[34]:\n\n\n##### Widget Tabs:  CSS styles\nraw_css_custom_tabs = """\n.bk-header {\n    font-size: 18pt;\n}\n.bk-tab.bk-active {\n    color:#4d4d4d;\n    border-color: #002147 !important;\n    border-bottom-width: 7px;\n}\n:host .bk-tab:nth-of-type(1) {\n    background-color: #fdc086 !important;\n}\n:host .bk-tab:nth-of-type(2) {\n    background-color: #beaed4 !important;\n}\n"""\nraw_css_custom_tabs_Node = """\n.bk-header {\n    font-size: 16pt;\n}\n:host(.bk-above) .bk-tab{\n    min-width: 220px;\n}\n.bk-tab.bk-active {\n    color:#4d4d4d;\n    border-color: #002147 !important;\n    border-bottom-width: 3px;\n}\n:host .bk-tab:nth-of-type(1) {\n    background-color: #9bbf7c !important;\n}\n:host .bk-tab:nth-of-type(2) {\n    background-color: #b8d9d4 !important;\n}\n:host .bk-tab:nth-of-type(3) {\n   background-color: #d3e1f2 !important;\n}\n"""\n\n\n# In[ ]:\n\n\n\n\n\n# In[35]:\n\n\npn.Row (TBL_E_interactive)\n\n\n# In[36]:\n\n\nUI_label[locale]['Any']\n\n\n# #### Tab: Node -----> pn_Node\n\n# In[37]:\n\n\n### pn_Node\npn.extension(design='fast')     \npn_Node_tabs = pn.Tabs( (UI_label[locale]['Main'], TBL_N_interactive_01),\n                         (UI_label[locale]['Secondary'], TBL_N_interactive_02),\n                         (UI_label[locale]['Any'], TBL_N_interactive_03),\n                        stylesheets=[raw_css_custom_tabs_Node],\n)\n# CSS raw_css_custom_tabs_Node used\npn_Node = pn.Column( \n    pn.Row( convert_further_anyway(UI_label[locale]["fTab Node Description"])  ),\n    pn.Row( widget_indicator_main_sel, widget_indicator_secondary_sel, widget_indicator_tertiary_sel),\n    pn_Node_tabs\n)\n\npn_Node\n\n\n# #### Tab: Edge -----> pn_Edge\n\n# In[38]:\n\n\nTBL_E_interactive_len = pn.bind( myExplorer.get_df_len, \n                       r=myExplorer.param.sel_reg_localeJ, \n                       y=myExplorer.param.sel_year_locale,\n                       #ei=slice(None), eo=slice(None), \n                       NorE = "E"                            \n                     )\n\n\n# In[39]:\n\n\n### pn_Edge\npn.extension(design='fast') \npn_Edge = pn.Column( \n    pn.Row( pn.pane.Str(UI_label[locale]["fTab Edge Description"]), TBL_E_interactive_len ),\n    TBL_E_interactive\n)\n\npn_Edge\n\n\n# #### Intergration\n\n# In[40]:\n\n\n## Putting pn_Edge and pn_Node into another Tab\npn_tabs_primary = pn.Tabs(\n    (UI_label[locale]["Node"], pn_Node),\n    (UI_label[locale]["Edge"], pn_Edge),\n    stylesheets=[raw_css_custom_tabs],\n)\n# CSS raw_css_custom_tabs used\n\n#pn_tabs_primary\n\n\n# In[ ]:\n\n\n\n\n\n# ### Echarts \n# #### Interactive Wigdets for Gravity and Repulsion\n# cf. \n# \n# #r=myExplorer.param.sel_reg_localeJ, \n# #y=myExplorer.param.sel_year_locale,\n# r=myExplorer.sel_reg_localeJ \n# y=myExplorer.sel_year_locale\n# \n\n# In[41]:\n\n\n# pn.bind(gen_Network_Graph, myExplorer.param.sel_reg_localeJ, myExplorer.param.sel_year_locale, myExplorer.param.sel_indicator_main)\ndef gen_Network_Graph (r, y, i, repulsion, gravity):\n    GdfN = myExplorer.get_df ( r=r, y=y, i=i)\\\n           .dropna() # remove any nodes with no weight values\n    GdfN.loc[:,'ttips'] = GdfN.loc[:,'ttips'].str.replace('\\n', '<br/>')\n    \n    GdfE = myExplorer.get_df ( r=r, y=y, NorE = "E")\n\n    # Echart_nodes\n    Echart_nodes = [\n        opts.GraphNode( name=row['Node'], \n                        value=row['value'],\n                        symbol_size=row['weight'],\n                        tooltip_opts=opts.TooltipOpts(formatter=row['ttips']),\n                        itemstyle_opts=opts.ItemStyleOpts(color=d_color[locale][row['Node']]),\n                        label_opts=opts.LabelOpts(color="#F09D00", font_size=8+int(20*row['weight'])/75),\n                      )\n    for ind, row in GdfN.reset_index().iterrows() ]\n    # Echart_edges\n    Echart_edges = [\n        opts.GraphLink( source=row["Input"], target=row["Output"], value=row["value"], \n                        linestyle_opts=opts.LineStyleOpts(width=row["weight"], curve=0.33, opacity=0.25),                    \n                      )\n    for ind, row in GdfE.reset_index().iterrows() ]  \n    _plot_title_ = f"\u4ea7\u4e1a\u6295\u5165\u4ea7\u51fa\u7f51\u7edc\\n({r}, {y}, {i})"#"Input-Output Network of Industries"\n    \n    Echart_Graph = ( Graph().add(\n        series_name=f"({r}, {y})",\n        nodes=Echart_nodes, links=Echart_edges,\n        layout="force", #"circular"\n        repulsion=repulsion, gravity=gravity,\n        edge_length=[10,50],\n        is_roam=True, is_focusnode=True, is_draggable=True,\n        label_opts = opts.LabelOpts(is_show=True),\n        tooltip_opts = opts.TooltipOpts(formatter='{b}: <br />{c}'),\n    )\n    .set_series_opts( \n    #    textstyle_opts  = opts.TextStyleOpts( font_size=36, border_color='black', border_width=12, shadow_color='white') ,\n    #    itemstyle_opts  = opts.ItemStyleOpts(  border_color='black', border_width=12) ,\n        label_opts = opts.LabelOpts (font_size=16, rotate=0),\n    # , text_border_width=3, text_border_color='black',   text_shadow_color = "whitesmoke", text_shadow_blur = .1, text_shadow_offset_x = .2, text_shadow_offset_y =.2\n    )\n    .set_global_opts( \n        title_opts = opts.TitleOpts(title=_plot_title_) \n    )\n    #.render("debug.html")\n    )\n    return Echart_Graph\n\n\n# In[42]:\n\n\n## Getting Interactive Graph and Putting it in the Panel\nEchart_Graph_inter = pn.bind( gen_Network_Graph, \n                               myExplorer.param.sel_reg_localeJ, myExplorer.param.sel_year_locale, myExplorer.param.sel_indicator_main,\n                               wg_slider_repulsion, wg_slider_gravity)\n\n## Layout: Use panel container\npn.extension ("echarts")\npn_Echart_Graph = pn.Row ( pn.pane.ECharts( Echart_Graph_inter, width=Layout_width[locale]["Echart"], height=850),\n                           pn_sidebar\n                         )\n                  \npn_Echart_Graph\n\n\n# In[ ]:\n\n\n\n\n\n# ## Tempalte_Param\n\n# In[43]:\n\n\n### template_param to be used in pn.template.FastGridTemplate\nDashboardTitle = UI_label[locale]["DashboardTitle"]\n\ntemplate_param= dict(\n    title = DashboardTitle,\n    main_max_width= "1000px",\n    theme_toggle=True,    \n    sidebar_width = Layout_width[locale]["sidebar"],\n    sidebar = pn_sidebar,\n    sidebar_footer = f"""<fast-breadcrumb><fast-breadcrumb-item href="https://oxon8.netlify.app">\xa9 2024 Oxford Roadmapping </fast-breadcrumb-item>\n    <fast-breadcrumb-item href="https://creativecommons.org/licenses/by-nc-nd/4.0">CC BY NC ND 4.0</fast-breadcrumb-item>\n    <fast-breadcrumb-item href="{UI_label[locale]['url_prj-visNetZero']}">visNetZero</fast-breadcrumb-item></fast-breadcrumb>""",\n    header_background="#002147", # Oxford blue color https://www.colorxs.com/palette/hex/002147-a3ced9-dae5f2\n    accent_base_color="#DAA520", # https://panel.holoviz.org/reference/templates/FastGridTemplate.html\n    prevent_collision=False,\n    meta_description = DashboardTitle + " by Oxford Roadmapping",\n    meta_keywords = "China; decarbonization; carbon emission; net zero; roadmapping;",\n    meta_author = "Han-Teng Liao",\n)\n"""\n    logo ="https://oxon8.netlify.app/icon.svg",#"https://oxon8.netlify.app/favicon.ico",\n    favicon = "https://oxon8.netlify.app/favicon.ico",\n    site_url = "https://oxon8.netlify.app/",\n    base_url = "https://oxon8.netlify.app/project/prj-visCEADs/",\n"""\n\n\n### PNtemplate Constructed using  pn.template.FastGridTemplate  \nif "zh" in locale:\n    PNtemplate = pn.template.FastGridTemplate(\n        font_url = 'https://fonts.loli.net/css?family=Open+Sans',\n        **template_param\n    )\nelse:\n    PNtemplate = pn.template.FastGridTemplate(\n        **template_param\n    )\n\n### Panel alltogether\n# Note. main figure and tabs added here: pn_sidebar\n#pn_ichart = pn.Column( NdOvl, w_YEAR_RANGE, sizing_mode="stretch_both", margin = 0 )\n\n#pn_ichart = pn.Column( )\n\nPNtemplate.main [0:3,0:12] = pn_Echart_Graph\nPNtemplate.main [3:7,0:12] = pn_tabs_primary\n\n\n# In[44]:\n\n\nlocale\n\n\n# In[46]:\n\n\nPNtemplate.servable()#. # okay\n\n\n# In[ ]:\n\nawait write_doc()
  `

  try {
    const [docs_json, render_items, root_ids] = await self.pyodide.runPythonAsync(code)
    self.postMessage({
      type: 'render',
      docs_json: docs_json,
      render_items: render_items,
      root_ids: root_ids
    })
  } catch(e) {
    const traceback = `${e}`
    const tblines = traceback.split('\n')
    self.postMessage({
      type: 'status',
      msg: tblines[tblines.length-2]
    });
    throw e
  }
}

self.onmessage = async (event) => {
  const msg = event.data
  if (msg.type === 'rendered') {
    self.pyodide.runPythonAsync(`
    from panel.io.state import state
    from panel.io.pyodide import _link_docs_worker

    _link_docs_worker(state.curdoc, sendPatch, setter='js')
    `)
  } else if (msg.type === 'patch') {
    self.pyodide.globals.set('patch', msg.patch)
    self.pyodide.runPythonAsync(`
    from panel.io.pyodide import _convert_json_patch
    state.curdoc.apply_json_patch(_convert_json_patch(patch), setter='js')
    `)
    self.postMessage({type: 'idle'})
  } else if (msg.type === 'location') {
    self.pyodide.globals.set('location', msg.location)
    self.pyodide.runPythonAsync(`
    import json
    from panel.io.state import state
    from panel.util import edit_readonly
    if state.location:
        loc_data = json.loads(location)
        with edit_readonly(state.location):
            state.location.param.update({
                k: v for k, v in loc_data.items() if k in state.location.param
            })
    `)
  }
}

startApplication()